<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Team Builder</title>
  <style>
    :root{
      --bg-dark:#0a0a0f;
      --panel:rgba(20,20,28,0.85);
      --gold:#d4af37;
      --muted:#aaa;
    }
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, rgba(5,6,10,0.92), rgba(12,10,18,0.88)),
        url("https://i.imgur.com/vATNRmF.png") center/cover fixed no-repeat;
      color:#f3f3f3;
      padding:32px;
      display:flex;
      justify-content:center;
      min-height:100vh;
      box-sizing:border-box;
    }
    .wrap{
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:24px;
      width:100%;
      max-width:1200px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--gold);
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 20px rgba(0,0,0,0.4);
    }
    h2,h3{margin-top:0;color:var(--gold)}
    input,select,textarea,button{
      font:inherit;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #333;
      background:#111;
      color:#eee;
      width:100%;
      box-sizing:border-box;
    }
    button{
      background:var(--gold);
      color:#000;
      font-weight:bold;
      cursor:pointer;
      border:none;
      transition:0.2s;
    }
    button:hover{filter:brightness(1.1)}
    .poke-slot{margin-bottom:16px; padding:10px; border:1px dashed var(--muted); border-radius:8px}
    .poke-slot h4{margin:0 0 6px 0; color:var(--gold)}
    .hint{color:var(--muted); font-size:0.9rem}
    .tier-badge{background:var(--gold); color:#000; padding:2px 6px; border-radius:6px; font-size:0.85em}
  </style>
</head>
<body>
  <div class="wrap">
    <main>
      <div class="card">
        <h2>Criar Time</h2>
        <form id="teamForm">
          <div style="margin-bottom:12px;">
            <label>Nome do Time</label>
            <input id="teamName" required>
          </div>
          <div style="margin-bottom:12px;">
            <label>Tier</label>
            <select id="teamTier" required>
              <option value="">-- Selecione --</option>
              <option>OU</option>
              <option>UU</option>
              <option>RU</option>
              <option>NU</option>
              <option>PU</option>
            </select>
          </div>
          <div id="pokemonList"></div>
          <button type="button" id="addPokemon">+ Adicionar Pokémon</button>
          <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
            <button type="button" id="importBtn">Importar Showdown</button>
            <button type="button" id="exportBtn">Exportar Showdown</button>
            <button type="button" id="copyBtn">Copiar</button>
            <button type="submit">Salvar Time</button>
          </div>
        </form>
      </div>
    </main>
    <aside class="right-col">
      <div class="card">
        <h3>Como usar o Team Builder</h3>
        <ol class="hint" style="padding-left:18px; line-height:1.5;">
          <li><strong>Nomeie seu time</strong> e escolha uma <span class="tier-badge">Tier</span> obrigatória.</li>
          <li><strong>Adicione Pokémon</strong> (até 6) preenchendo Nome, Item, Ability, Nature, EVs/IVs e Moves.</li>
          <li>Use <strong>Importar Showdown</strong> para colar times ou <strong>Exportar Showdown</strong> para levar pro Showdown.</li>
          <li><strong>Salve</strong> seu time no Firebase (apenas estando logado).</li>
        </ol>
      </div>
      <div style="height:14px"></div>
      <div class="card">
        <h3>Regras de validação</h3>
        <ul class="hint" style="padding-left:18px; line-height:1.5;">
          <li>EVs por stat: <strong>0–252</strong></li>
          <li>Total de EVs ≤ <strong>510</strong></li>
          <li>IVs: <strong>0–31</strong></li>
          <li>Máx. <strong>4 moves</strong> por Pokémon</li>
          <li>Máx. <strong>6 Pokémon</strong> no time</li>
        </ul>
      </div>
      <div style="height:14px"></div>
      <div class="card">
        <h3>Autenticação</h3>
        <p class="hint" style="line-height:1.5;">
          Para <strong>salvar seus times</strong> você precisa estar logado.<br>
          Você pode entrar com sua conta <strong>Google</strong> ou criar uma conta com <strong>e-mail</strong>.
        </p>
      </div>
    </aside>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "SUA_APIKEY",
    authDomain: "SEU_PROJECT.firebaseapp.com",
    databaseURL: "https://SEU_PROJECT.firebaseio.com",
    projectId: "SEU_PROJECT",
    storageBucket: "SEU_PROJECT.appspot.com",
    messagingSenderId: "0000000000",
    appId: "1:0000000000:web:xxxxxxxx"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const pokemonList = document.getElementById('pokemonList');
  const addPokemonBtn = document.getElementById('addPokemon');
  let pokeCount=0;

  addPokemonBtn.onclick=()=>{
    if(pokeCount>=6){alert("Máximo de 6 Pokémon.");return;}
    pokeCount++;
    const div=document.createElement('div');
    div.className="poke-slot";
    div.innerHTML=`<h4>Pokémon ${pokeCount}</h4>
      <label>Nome <input class="pname"></label><br>
      <label>Item <input class="pitem"></label><br>
      <label>Ability <input class="pability"></label><br>
      <label>Nature <input class="pnature"></label><br>
      <label>Tera <input class="ptera"></label><br>
      <label>EVs <input class="pevs" placeholder="hp/atk/def/spa/spd/spe"></label><br>
      <label>IVs <input class="pivs" placeholder="hp/atk/def/spa/spd/spe"></label><br>
      <label>Moves <textarea class="pmoves" placeholder="1 por linha"></textarea></label>`;
    pokemonList.appendChild(div);
  };

  function collectTeamData(){
    const team={};
    team.name=document.getElementById('teamName').value.trim();
    team.tier=document.getElementById('teamTier').value;
    team.pokemon=[];
    pokemonList.querySelectorAll('.poke-slot').forEach(slot=>{
      const p={};
      p.name=slot.querySelector('.pname').value;
      p.item=slot.querySelector('.pitem').value;
      p.ability=slot.querySelector('.pability').value;
      p.nature=slot.querySelector('.pnature').value;
      p.tera=slot.querySelector('.ptera').value;
      p.evs=slot.querySelector('.pevs').value;
      p.ivs=slot.querySelector('.pivs').value;
      p.moves=slot.querySelector('.pmoves').value.split("\\n").filter(x=>x);
      team.pokemon.push(p);
    });
    team.createdAt=Date.now();
    return team;
  }

  document.getElementById('teamForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const user=auth.currentUser;
    if(!user){alert("É preciso estar logado."); return;}
    const team=collectTeamData();
    team.owner=user.uid;
    team.ownerName=user.displayName||user.email;
    const teamRef=push(ref(db,'teams'));
    await set(teamRef,team);
    alert("Time salvo com sucesso!");
    window.location.href="simple_teams.html";
  });

  // Import/Export simples
  document.getElementById('exportBtn').onclick=()=>{
    const team=collectTeamData();
    let txt="";
    team.pokemon.forEach(p=>{
      txt+=p.name+" @ "+p.item+"\\n";
      if(p.ability) txt+="Ability: "+p.ability+"\\n";
      if(p.nature) txt+=p.nature+" Nature\\n";
      if(p.evs) txt+="EVs: "+p.evs+"\\n";
      (p.moves||[]).forEach(m=>txt+="- "+m+"\\n");
      txt+="\\n";
    });
    const w=window.open();
    w.document.write("<pre>"+txt+"</pre>");
  };

  document.getElementById('copyBtn').onclick=()=>{
    const team=collectTeamData();
    let txt="";
    team.pokemon.forEach(p=>{
      txt+=p.name+" @ "+p.item+"\\n";
      if(p.ability) txt+="Ability: "+p.ability+"\\n";
      if(p.nature) txt+=p.nature+" Nature\\n";
      if(p.evs) txt+="EVs: "+p.evs+"\\n";
      (p.moves||[]).forEach(m=>txt+="- "+m+"\\n");
      txt+="\\n";
    });
    navigator.clipboard.writeText(txt);
    alert("Copiado!");
  };

  document.getElementById('importBtn').onclick=()=>{
    const txt=prompt("Cole o texto do Showdown aqui:");
    if(!txt) return;
    pokemonList.innerHTML=""; pokeCount=0;
    const blocks=txt.split(/\\n\\n+/);
    blocks.forEach(b=>{
      if(!b.trim()) return;
      addPokemonBtn.onclick();
      const slot=pokemonList.lastChild;
      const lines=b.split(/\\n/);
      let first=lines[0].split(" @ ");
      slot.querySelector('.pname').value=first[0].trim();
      if(first[1]) slot.querySelector('.pitem').value=first[1].trim();
      lines.slice(1).forEach(l=>{
        if(l.startsWith("Ability:")) slot.querySelector('.pability').value=l.replace("Ability:","").trim();
        else if(l.endsWith("Nature")) slot.querySelector('.pnature').value=l.replace("Nature","").trim();
        else if(l.startsWith("EVs:")) slot.querySelector('.pevs').value=l.replace("EVs:","").trim();
        else if(l.startsWith("-")) slot.querySelector('.pmoves').value+=(l.replace("-","").trim()+"\\n");
      });
    });
  };
</script>
</body>
</html>
