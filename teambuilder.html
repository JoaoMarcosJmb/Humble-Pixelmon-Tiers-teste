<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Humble Team Builder</title>
  <style>
    :root{
      --bg-dark:#0a0a0f;
      --panel:rgba(20,20,28,0.85);
      --gold:#d4af37;
      --muted:#aaa;
    }
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, rgba(5,6,10,0.92), rgba(12,10,18,0.88)),
        url("https://i.imgur.com/vATNRmF.png") center/cover fixed no-repeat;
      color:#f3f3f3;
      padding:32px;
      display:flex;
      justify-content:center;
      min-height:100vh;
      box-sizing:border-box;
    }
    .wrap{
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:24px;
      width:100%;
      max-width:1200px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--gold);
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 20px rgba(0,0,0,0.4);
    }
    h1,h2,h3{margin-top:0;color:var(--gold)}
    input,select,textarea{
      font:inherit;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #333;
      background:#111;
      color:#eee;
      width:100%;
      box-sizing:border-box;
    }
    textarea{resize:vertical;}
    .btn{
      padding:8px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
      transition:0.2s;
    }
    .btn-primary{
      background:var(--gold);
      color:#000;
      border:none;
    }
    .btn-secondary{
      background:transparent;
      color:var(--gold);
      border:1px solid var(--gold);
    }
    .btn-add{
      background:#222;
      border:1px dashed var(--gold);
      color:var(--gold);
      width:100%;
    }
    .btn:hover{filter:brightness(1.1);}
    .poke-slot{
      margin-bottom:16px;
      padding:14px;
      border:1px solid var(--gold);
      border-radius:12px;
      background:rgba(0,0,0,0.3);
    }
    .poke-slot h4{
      margin:0 0 8px 0;
      font-size:1.1rem;
      color:var(--gold);
    }
    .hint{color:var(--muted); font-size:0.9rem}
    .tier-badge{background:var(--gold); color:#000; padding:2px 6px; border-radius:6px; font-size:0.85em}
    
    /* header */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
    }
    .header-left{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .mascote{width:56px; height:56px;}
    .title-box h1{
      margin:0;
      color:var(--gold);
      font-size:1.8rem;
      line-height:1.2;
    }
    .title-box h2{
      margin:0;
      color:#fff;
      font-size:1rem;
      font-weight:400;
      line-height:1.2;
    }
    #userBox{color:var(--muted); margin-right:10px;}
  </style>
</head>
<body>
  <div class="wrap">
    <main>
      <div class="header">
        <div class="header-left">
          <img src="https://i.imgur.com/XOEcuO8.png" alt="Mascote" class="mascote">
          <div class="title-box">
            <h1>Humble</h1>
            <h2>Team Builder</h2>
          </div>
        </div>
        <div class="header-right">
          <span id="userBox"></span>
          <button id="loginBtn" class="btn btn-secondary">Entrar</button>
        </div>
      </div>
      
      <div class="card">
        <h2>Criar Time</h2>
        <form id="teamForm">
          <div style="margin-bottom:12px;">
            <label>Nome do Time</label>
            <input id="teamName" required>
          </div>
          <div style="margin-bottom:12px;">
            <label>Tier</label>
            <select id="teamTier" required>
              <option value="">-- Selecione --</option>
              <option>LC</option>
              <option>Monotype</option>
              <option>NU</option>
              <option>National Dex</option>
              <option>National Dex Monotype</option>
              <option>National Dex UU</option>
              <option>OU</option>
              <option>PU</option>
              <option>RU</option>
              <option>Ubers</option>
              <option>UU</option>
              <option>ZU</option>
              <option>National Dex RU</option>
              <option>Monomon</option>
              <option>Starter League</option>
              <option>Only Smeargle</option>
              <option>National Dex Ubers</option>
              <option>National Dex AG</option>
            </select>
          </div>
          <div id="pokemonList"></div>
          <button type="button" id="addPokemon" class="btn btn-add">+ Adicionar Pokémon</button>
          <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
            <button type="button" id="importBtn" class="btn btn-secondary">Importar</button>
            <button type="button" id="exportBtn" class="btn btn-secondary">Exportar</button>
            <button type="button" id="copyBtn" class="btn btn-secondary">Copiar</button>
            <button type="submit" class="btn btn-primary">Salvar Time</button>
          </div>
        </form>
      </div>
    </main>
    
    <aside class="right-col">
      <div class="card">
        <h3>Como usar o Team Builder</h3>
        <ol class="hint" style="padding-left:18px; line-height:1.5;">
          <li><strong>Nomeie seu time</strong> e escolha uma <span class="tier-badge">Tier</span>.</li>
          <li><strong>Adicione Pokémon</strong> (até 6) com Nome, Item, Ability, Nature, EVs/IVs e Moves.</li>
          <li>Use <strong>Importar</strong> ou <strong>Exportar</strong> em formato Showdown.</li>
          <li><strong>Salve</strong> seu time no Firebase (precisa estar logado).</li>
        </ol>
      </div>
      <div style="height:14px"></div>
      <div class="card">
        <h3>Regras de validação</h3>
        <ul class="hint" style="padding-left:18px; line-height:1.5;">
          <li>EVs por stat: <strong>0–252</strong></li>
          <li>Total de EVs ≤ <strong>510</strong></li>
          <li>IVs: <strong>0–31</strong></li>
          <li>Máx. <strong>4 moves</strong> por Pokémon</li>
          <li>Máx. <strong>6 Pokémon</strong> no time</li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- datalist para autocomplete de Pokémon -->
  <datalist id="pokemonListData"></datalist>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCno7O_ZGLTDYvSG5kzYU-KpduucWcxQe8",
  authDomain: "sampleteans.firebaseapp.com",
  databaseURL: "https://sampleteans-default-rtdb.firebaseio.com",
  projectId: "sampleteans",
  storageBucket: "sampleteans.firebasestorage.app",
  messagingSenderId: "1069510029261",
  appId: "1:1069510029261:web:ccafa840ebf0e2a0e85e84"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  const provider = new GoogleAuthProvider();

  const loginBtn = document.getElementById("loginBtn");
  const userBox = document.getElementById("userBox");

  onAuthStateChanged(auth, user=>{
    if(user){
      userBox.textContent = user.displayName || user.email;
      loginBtn.textContent = "Sair";
    } else {
      userBox.textContent = "";
      loginBtn.textContent = "Entrar";
    }
  });

  loginBtn.onclick = ()=>{
    if(auth.currentUser){
      signOut(auth);
    } else {
      signInWithPopup(auth, provider).catch(err=>alert("Erro: "+err.message));
    }
  };

  // carregar lista de pokémons para autocomplete
  fetch("pokemon.json")
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById("pokemonListData");
      data.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.name;
        list.appendChild(opt);
      });
    });

  const pokemonList = document.getElementById('pokemonList');
  const addPokemonBtn = document.getElementById('addPokemon');
  let pokeCount=0;

  addPokemonBtn.onclick=()=>{
    if(pokeCount>=6){alert("Máximo de 6 Pokémon.");return;}
    pokeCount++;
    const div=document.createElement('div');
    div.className="poke-slot";
    div.innerHTML=`<h4>Pokémon ${pokeCount}</h4>
      <label>Nome <input class="pname" list="pokemonListData"></label><br><br>
      <label>Item <input class="pitem"></label><br><br>
      <label>Ability <input class="pability"></label><br><br>
      <label>Nature 
        <select class="pnature">
          <option value="">-- Selecione --</option>
          <option>Adamant</option><option>Bashful</option><option>Bold</option><option>Brave</option>
          <option>Calm</option><option>Careful</option><option>Docile</option><option>Gentle</option>
          <option>Hardy</option><option>Hasty</option><option>Impish</option><option>Jolly</option>
          <option>Lax</option><option>Lonely</option><option>Mild</option><option>Modest</option>
          <option>Naive</option><option>Naughty</option><option>Quiet</option><option>Quirky</option>
          <option>Rash</option><option>Relaxed</option><option>Sassy</option><option>Serious</option><option>Timid</option>
        </select>
      </label><br><br>
      <label>Tera <input class="ptera" placeholder="Opcional"></label><br><br>
      <label>EVs <input class="pevs" placeholder="hp/atk/def/spa/spd/spe"></label><br><br>
      <label>IVs <input class="pivs" placeholder="hp/atk/def/spa/spd/spe"></label><br><br>
      <label>Moves <textarea class="pmoves" placeholder="1 por linha"></textarea></label>`;
    pokemonList.appendChild(div);
  };

  function collectTeamData(){
    const team={};
    team.name=document.getElementById('teamName').value.trim();
    team.tier=document.getElementById('teamTier').value;
    team.pokemon=[];
    pokemonList.querySelectorAll('.poke-slot').forEach(slot=>{
      const p={};
      p.name=slot.querySelector('.pname').value;
      p.item=slot.querySelector('.pitem').value;
      p.ability=slot.querySelector('.pability').value;
      p.nature=slot.querySelector('.pnature').value;
      p.tera=slot.querySelector('.ptera').value || null; // opcional
      p.evs=slot.querySelector('.pevs').value;
      p.ivs=slot.querySelector('.pivs').value;
      p.moves=slot.querySelector('.pmoves').value.split("\n").filter(x=>x);
      team.pokemon.push(p);
    });
    team.createdAt=Date.now();
    return team;
  }

  document.getElementById('teamForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const user=auth.currentUser;
    if(!user){alert("É preciso estar logado."); return;}
    const team=collectTeamData();
    team.owner=user.uid;
    team.ownerName=user.displayName||user.email;
    const teamRef=push(ref(db,'teams'));
    await set(teamRef,team);
    alert("Time salvo com sucesso!");
    window.location.href="simple_teams.html";
  });
</script>
</body>
</html>
