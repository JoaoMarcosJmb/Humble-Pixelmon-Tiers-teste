<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Humble Builder - Final</title>
  
  <link rel="icon" type="image/png" href="img/mike_anotando2.png">
  
  <style>
    /* --- CSS VARI√ÅVEIS --- */
    :root { 
      --cor-dourado: #d1a720; 
      --cor-fundo: #1a1a1a; 
      --cor-texto: #f5f5f5; 
      --cor-input: #252525; 
      --cor-borda: #444;
    }

    body { 
      font-family: "Segoe UI", Arial, sans-serif; 
      background: linear-gradient(135deg, rgba(15,15,15,0.95), rgba(30,25,20,0.95)), 
                  url("https://i.imgur.com/vATNRmF.png"); 
      background-size: cover; 
      background-attachment: fixed;
      margin: 0; padding-top: 80px; color: var(--cor-texto); 
    }
    
    /* --- HEADER --- */
    header { 
      position: fixed; top: 0; left: 0; right: 0; width: 100%; padding: 10px 20px; 
      display: flex; justify-content: space-between; align-items: center; 
      background: rgba(15, 15, 15, 0.98); border-bottom: 2px solid var(--cor-dourado); 
      z-index: 1000; box-sizing: border-box; box-shadow: 0 4px 15px rgba(0,0,0,0.7);
    }
    header h1 { font-size: 1.4rem; color: var(--cor-dourado); display: flex; gap: 10px; margin: 0; align-items: center; }
    header h1 img { height: 35px; }
    header a { text-decoration: none; color: inherit; display:flex; align-items:center; gap:10px; }

    .menu-toggle { display: flex; flex-direction: column; width: 30px; gap: 6px; cursor: pointer; z-index: 1100; }
    .menu-toggle span { display: block; height: 3px; background: var(--cor-texto); border-radius: 4px; transition: 0.3s; }
    .menu-toggle.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 6px); }
    .menu-toggle.active span:nth-child(2) { opacity: 0; }
    .menu-toggle.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -6px); }

    nav { 
      position: absolute; top: 60px; right: 20px; background: rgba(30, 25, 20, 0.98); 
      border: 1px solid var(--cor-dourado); border-radius: 8px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.8); display: none; 
      flex-direction: column; padding: 15px; gap: 12px; z-index: 1200; width: 220px; 
    }
    nav.active { display: flex; }
    nav a { color: var(--cor-dourado); font-weight: 500; transition: 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }

    /* --- LAYOUT --- */
    .builder-wrapper { max-width: 1000px; margin: 0 auto; padding: 20px; }

    /* TOOLBAR LIMPA */
    .toolbar {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
      background: rgba(30,30,30,0.8); padding: 15px; border-radius: 8px; border: 1px solid var(--cor-borda);
      flex-wrap: wrap; gap: 15px;
    }
    .toolbar-title h2 { margin: 0; color: #fff; font-size: 1.5rem; }
    .toolbar-title small { color: #aaa; }
    .toolbar-controls { display: flex; gap: 15px; align-items: center; height: 42px; }

    .tier-select {
        background: #111; color: var(--cor-dourado); border: 1px solid var(--cor-dourado);
        padding: 0 15px; border-radius: 5px; font-weight: bold; cursor: pointer;
        font-size: 0.95rem; min-width: 180px; height: 100%; box-sizing: border-box;
    }
    .tier-select:focus { outline: none; box-shadow: 0 0 8px rgba(209, 167, 32, 0.3); }

    .btn-action {
      background: var(--cor-dourado); border: none; padding: 0 25px; font-weight: bold;
      cursor: pointer; border-radius: 4px; color: #111; font-size: 0.95rem; transition: 0.2s;
      height: 100%; display: flex; align-items: center; gap: 8px;
    }
    .btn-action:hover { background: #fff; box-shadow: 0 0 15px rgba(209, 167, 32, 0.5); }

    /* --- ABAS --- */
    .tabs-wrapper { display: flex; align-items: flex-end; gap: 5px; margin-bottom: 0; padding-left: 5px; }
    .tab-slot {
        background: #222; border: 1px solid #444; border-bottom: none; border-radius: 8px 8px 0 0;
        width: 70px; height: 50px; cursor: pointer; display: flex; justify-content: center; align-items: center;
        opacity: 0.6; transition: all 0.2s; position: relative;
    }
    .tab-slot:hover { opacity: 0.9; background: #2a2a2a; }
    .tab-slot.active {
        opacity: 1; background: rgba(25, 25, 25, 0.95); border-color: var(--cor-dourado);
        border-bottom: 1px solid rgba(25, 25, 25, 0.95); height: 55px; z-index: 10; margin-bottom: -1px;
    }
    .tab-icon { width: 40px; height: 40px; object-fit: contain; }

    .add-tab-btn {
        width: 40px; height: 40px; background: #222; border: 1px dashed #666; border-radius: 8px 8px 0 0;
        color: #888; font-size: 1.5rem; cursor: pointer; display: flex; justify-content: center; align-items: center;
        transition: 0.2s; margin-bottom: 5px;
    }
    .add-tab-btn:hover { background: #333; color: var(--cor-dourado); border-color: var(--cor-dourado); }
    .add-tab-btn.hidden { display: none; }

    /* --- EDITOR --- */
    .editor-container-wrapper {
        background: rgba(25, 25, 25, 0.95); border: 1px solid var(--cor-dourado); border-radius: 0 8px 8px 8px; 
        padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); min-height: 500px;
    }
    .poke-editor { display: none; animation: fadeIn 0.3s ease; }
    .poke-editor.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    
    .header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
    .header-row h4 { margin: 0; color: var(--cor-dourado); font-size: 1.2rem; }

    .editor-layout { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }
    .visual-large-box {
        width: 120px; height: 120px; flex-shrink: 0;
        background: rgba(0,0,0,0.3); border: 1px solid #444; border-radius: 10px;
        display: flex; justify-content: center; align-items: center;
    }
    .poke-sprite-large { width: 100px; height: 100px; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.6)); }

    .inputs-area { flex-grow: 1; min-width: 300px; display: flex; flex-direction: column; gap: 15px; }

    /* Inputs */
    .row { display: flex; gap: 15px; }
    .col { flex: 1; }
    .col-small { width: 80px; flex: none; }
    .input-with-icon { display: flex; align-items: center; gap: 8px; }
    .item-icon-img { width: 30px; height: 30px; object-fit: contain; opacity: 0.3; transition: opacity 0.3s; }
    .item-icon-img.active { opacity: 1; }

    label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 4px; }
    input[type="text"], input[type="number"], select {
        background: var(--cor-input); border: 1px solid var(--cor-borda); color: #fff;
        padding: 8px 10px; border-radius: 4px; width: 100%; box-sizing: border-box; font-size: 0.95rem; height: 38px;
    }
    input:focus, select:focus { border-color: var(--cor-dourado); outline: none; background: #303030; }

    .iv-section { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 4px; border: 1px solid #333; }
    .iv-grid { display: flex; gap: 10px; justify-content: space-between; }
    .iv-box { text-align: center; width: 100%; }
    .iv-box label { font-size: 0.75rem; color: #666; }
    .iv-box input { text-align: center; font-size: 0.9rem; background: #1a1a1a; }

    .stats-box { margin-top: 10px; }
    .ev-header { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 8px; color: #aaa; }
    .stat-row { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
    .stat-label { width: 30px; font-weight: bold; font-size: 0.85rem; color: #888; }
    input[type=range] { -webkit-appearance: none; width: 100%; height: 6px; background: #333; border-radius: 3px; outline: none; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--cor-dourado); border-radius: 50%; cursor: pointer; }
    .ev-num { width: 50px !important; text-align: center; padding: 0 !important; font-size: 0.9rem !important; }

    .move-input { border-left: 4px solid #555 !important; margin-bottom: 8px; height: 38px !important; }
    .move-input:focus { border-left-color: var(--cor-dourado) !important; }

    /* --- MODAL UNIFICADO --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 2000;
        display: none; justify-content: center; align-items: center;
        backdrop-filter: blur(5px);
    }
    .modal-content {
        background: #1a1a1a; border: 2px solid var(--cor-dourado);
        padding: 25px; border-radius: 12px; width: 90%; max-width: 700px;
        box-shadow: 0 0 30px rgba(0,0,0,0.9);
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .modal-title { margin: 0; color: var(--cor-dourado); font-size: 1.4rem; }
    .modal-close { cursor: pointer; color: #888; font-size: 1.5rem; transition: 0.2s; }
    .modal-close:hover { color: #fff; }

    .modal-textarea {
        width: 100%; height: 300px; background: #222; color: #fff;
        border: 1px solid #444; padding: 15px; box-sizing: border-box;
        margin-bottom: 20px; font-family: "Consolas", monospace; font-size: 0.9rem;
        resize: vertical;
    }
    .modal-textarea:focus { border-color: var(--cor-dourado); outline: none; }

    .modal-buttons { display: flex; justify-content: flex-end; gap: 15px; }
    .btn-secondary { background: transparent; color: #ccc; border: 1px solid #555; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    .btn-secondary:hover { border-color: #fff; color: #fff; }
    
    .btn-primary { background: var(--cor-dourado); color: #000; border: none; padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    .btn-primary:hover { background: #fff; }

  </style>
</head>
<body>

  <datalist id="list-pokemon"></datalist>
  <datalist id="list-items"></datalist>
  <datalist id="list-abilities">
    <option value="Intimidate"><option value="Levitate"><option value="Rough Skin"><option value="Pressure"><option value="Swift Swim">
    <option value="Chlorophyll"><option value="Sand Stream"><option value="Drizzle"><option value="Regenerator"><option value="Beast Boost">
    <option value="Technician"><option value="Mold Breaker"><option value="Prankster"><option value="Magic Bounce"><option value="Libero">
  </datalist>
  <datalist id="list-moves">
    <option value="Earthquake"><option value="Thunderbolt"><option value="Ice Beam"><option value="Flamethrower"><option value="Protect">
    <option value="Toxic"><option value="Scald"><option value="U-turn"><option value="Stealth Rock"><option value="Defog"><option value="Roost">
    <option value="Swords Dance"><option value="Calm Mind"><option value="Close Combat"><option value="Shadow Ball"><option value="Volt Switch">
  </datalist>

  <div class="modal-overlay" id="ioModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Importar / Exportar Time</h3>
        <span class="modal-close" onclick="closeModal()">√ó</span>
      </div>
      <p style="color:#aaa; font-size:0.9rem; margin-top:-10px; margin-bottom:15px;">
        Copie o texto abaixo para salvar seu time, ou cole um time do Showdown aqui para carregar.
      </p>
      <textarea id="ioText" class="modal-textarea" spellcheck="false"></textarea>
      <div class="modal-buttons">
        <button class="btn-secondary" onclick="copyToClipboard()">Copiar Texto</button>
        <button class="btn-primary" onclick="processImport()">Salvar (Importar)</button>
      </div>
    </div>
  </div>

  <header>
    <h1>
        <a href="feed.html">
            <img src="https://i.imgur.com/XOEcuO8.png"> Humble Builder
        </a>
    </h1>
    <div class="menu-toggle" id="menuBtn"><span></span><span></span><span></span></div>
  </header>

  <nav id="dropdownMenu">
    <a href="feed.html">üè† In√≠cio (Feed)</a>
    <a href="https://www.humblepixelmon.com.br">üåê Site Oficial</a>
    <a href="#">üó°Ô∏è Tiers 1.12</a>
    <a href="#">üõ°Ô∏è Tiers 1.16</a>
    <a href="#">üìù Notas de Atualiza√ß√£o</a>
  </nav>

  <div class="builder-wrapper">
    <div class="toolbar">
      <div class="toolbar-title">
        <h2>Criar Time</h2>
        <small>Selecione a Tier e monte sua estrat√©gia</small>
      </div>
      <div class="toolbar-controls">
        <select id="teamTier" class="tier-select" onchange="carregarDados(this.value)">
            <option value="" disabled selected>Selecionar Tier</option>
            <option value="AG">AG</option>
            <option value="Uber">Uber</option>
            <option value="OU">OU</option>
            <option value="UU">UU</option>
            <option value="RU">RU</option>
            <option value="NU">NU</option>
            <option value="PU">PU</option>
            <option value="ZU">ZU</option>
            <option value="NFE">NFE</option>
            <option value="LC">LC</option>
        </select>
        
        <button class="btn-action" onclick="openIOModal()">
            üíæ Import / Export
        </button>
      </div>
    </div>

    <div class="tabs-wrapper">
        <div id="tabsContainer" style="display:flex; gap:5px;"></div>
        <button id="addSlotBtn" class="add-tab-btn" onclick="addNewSlot()">+</button>
    </div>

    <div class="editor-container-wrapper" id="editorsContainer"></div>
  </div>

  <script>
    // --- GERAIS ---
    const menuBtn = document.getElementById("menuBtn");
    const dropdownMenu = document.getElementById("dropdownMenu");
    menuBtn.addEventListener("click", () => { menuBtn.classList.toggle("active"); dropdownMenu.classList.toggle("active"); });
    
    document.addEventListener("click", (e) => {
      if (!dropdownMenu.contains(e.target) && !menuBtn.contains(e.target)) {
        menuBtn.classList.remove("active"); dropdownMenu.classList.remove("active");
      }
    });

    const MAX_EVS = 508;
    const MAX_SLOTS = 6;
    const STATS = ['HP', 'Atk', 'Def', 'SpA', 'SpD', 'Spe'];
    const NATURES = ["Adamant", "Bashful", "Bold", "Brave", "Calm", "Careful", "Docile", "Gentle", "Hardy", "Hasty", "Impish", "Jolly", "Lax", "Lonely", "Mild", "Modest", "Naive", "Naughty", "Quiet", "Quirky", "Rash", "Relaxed", "Sassy", "Serious", "Timid"];
    const IMG_PATH = "img/official-artwork/"; 
    const IMG_ERROR = "https://img.pokemondb.net/sprites/items/poke-ball.png"; 
    const ITEM_ICON_BASE = "https://play.pokemonshowdown.com/sprites/itemicons/";
    
    let pokemonIdMap = {};
    let todosItens = [];
    let slotCounter = 0;

    function formatToApiName(name) { return name.trim().toLowerCase().replace(/ /g, '-').replace(/\./g, '').replace(/'/g, '').replace(/:/g, '').replace(/‚ôÄ/g, '-f').replace(/‚ôÇ/g, '-m'); }
    function formatItemToShowdown(name) { return name.toLowerCase().replace(/[^a-z0-9]/g, ''); }

    window.onload = function() { 
        initItens(); 
        addNewSlot(); 
    };

    async function initItens() {
        try {
            const response = await fetch('builder/itens.json');
            if (response.ok) {
                todosItens = await response.json();
                atualizarListaItens(null);
            }
        } catch (e) { console.log("Erro itens:", e); }
    }

    function carregarDados(tier) {
        carregarPokemonDaTier(tier);
        atualizarListaItens(tier);
    }

    async function carregarPokemonDaTier(tier) {
        const datalist = document.getElementById('list-pokemon');
        datalist.innerHTML = ""; 
        try {
            const response = await fetch(`tiers_1.16/${tier}.json`);
            if (response.ok) {
                const data = await response.json();
                Object.keys(data).forEach(nome => {
                    const opt = document.createElement('option'); opt.value = nome; datalist.appendChild(opt);
                    if (data[nome].id) pokemonIdMap[nome] = data[nome].id;
                });
            }
        } catch (e) { alert("Erro ao carregar Tier. Verifique se o arquivo JSON existe."); }
    }

    function atualizarListaItens(tier) {
        const dl = document.getElementById('list-items'); dl.innerHTML = ""; 
        todosItens.forEach(i => {
            if (tier && i.ban && i.ban.includes(tier)) return; 
            const opt = document.createElement('option'); opt.value = i.name; dl.appendChild(opt);
        });
    }

    // --- SLOTS & TABS ---
    function addNewSlot() {
        if (document.querySelectorAll('.tab-slot').length >= MAX_SLOTS) return;
        slotCounter++; const id = slotCounter;

        const tab = document.createElement('div');
        tab.className = 'tab-slot'; tab.id = `tab-${id}`;
        tab.onclick = () => switchTab(id);
        tab.innerHTML = `<img src="${IMG_ERROR}" id="tab-img-${id}" class="tab-icon">`;
        document.getElementById('tabsContainer').appendChild(tab);

        const editor = document.createElement('div');
        editor.className = 'poke-editor'; editor.id = `editor-${id}`;
        editor.innerHTML = generateEditorHTML(id);
        document.getElementById('editorsContainer').appendChild(editor);

        switchTab(id);
        updateAddBtnVisibility();
        return id;
    }

    function updateAddBtnVisibility() {
        const btn = document.getElementById('addSlotBtn');
        if (document.querySelectorAll('.tab-slot').length >= MAX_SLOTS) btn.classList.add('hidden');
        else btn.classList.remove('hidden');
    }

    function switchTab(id) {
        document.querySelectorAll('.tab-slot').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.poke-editor').forEach(e => e.classList.remove('active'));
        document.getElementById(`tab-${id}`)?.classList.add('active');
        document.getElementById(`editor-${id}`)?.classList.add('active');
    }

    function generateEditorHTML(id) {
        const nOpts = NATURES.map(n => `<option value="${n}">${n}</option>`).join('');
        return `
          <div class="header-row"><h4>Pok√©mon Set</h4></div>
          <div class="editor-layout">
            <div class="visual-large-box"><img src="${IMG_ERROR}" id="img-${id}" class="poke-sprite-large" onerror="this.src='${IMG_ERROR}'"></div>
            <div class="inputs-area">
                <div class="row">
                    <div class="col"><label>Pok√©mon</label><input type="text" class="p-name" list="list-pokemon" placeholder="Pok√©mon" onchange="updateImage('${id}', this)"></div>
                    <div class="col"><label>Item</label><div class="input-with-icon"><input type="text" class="p-item" list="list-items" placeholder="Item" oninput="updateItemIcon('${id}', this)"><img id="item-icon-${id}" class="item-icon-img" src=""></div></div>
                </div>
                <div class="row">
                    <div class="col"><label>Ability</label><input type="text" class="p-ability" list="list-abilities" placeholder="Ability"></div>
                    <div class="col"><label>Nature</label><select class="p-nature"><option value="" disabled selected>Nature</option>${nOpts}</select></div>
                    <div class="col-small"><label>Level</label><input type="number" class="p-level" value="100" min="1" max="100"></div>
                </div>
                <div class="iv-section"><div class="iv-grid">
                    ${STATS.map(s => `<div class="iv-box"><label>${s}</label><input type="text" class="p-iv-${s.toLowerCase()}" value="31"></div>`).join('')}
                </div></div>
            </div>
          </div>
          <div class="stats-box"><div class="ev-header"><span>EVs</span><span id="remain-${id}" class="ev-remaining">Restam: 508</span></div>
            ${STATS.map(s => `<div class="stat-row"><span class="stat-label">${s}</span><input type="range" min="0" max="252" value="0" step="4" oninput="updateEV('${id}', '${s}', this.value)" id="range-${id}-${s}"><input type="number" class="ev-num p-ev-${s.toLowerCase()}" min="0" max="252" value="0" step="4" onchange="updateEV('${id}', '${s}', this.value)" id="num-${id}-${s}"></div>`).join('')}
          </div>
          <div style="margin-top:20px;">
            <input type="text" class="move-input p-move" list="list-moves" placeholder="- Move 1">
            <input type="text" class="move-input p-move" list="list-moves" placeholder="- Move 2">
            <input type="text" class="move-input p-move" list="list-moves" placeholder="- Move 3">
            <input type="text" class="move-input p-move" list="list-moves" placeholder="- Move 4">
          </div>
        `;
    }

    // --- IMAGENS ---
    function updateImage(id, input) {
        const val = input.value;
        const img = document.getElementById(`img-${id}`);
        const tabImg = document.getElementById(`tab-img-${id}`);
        if (!val || val.length < 2) { img.src = IMG_ERROR; tabImg.src = IMG_ERROR; return; }
        
        let src = "";
        if (pokemonIdMap[val]) src = `${IMG_PATH}${pokemonIdMap[val]}.png`;
        else src = `${IMG_PATH}${formatToApiName(val)}.png`;
        img.src = src; tabImg.src = src;
    }

    function updateItemIcon(id, input) {
        const val = input.value;
        const icon = document.getElementById(`item-icon-${id}`);
        if (!val || val.length < 2) { icon.src=""; icon.classList.remove('active'); return; }
        icon.src = `${ITEM_ICON_BASE}${formatItemToShowdown(val)}.png`;
        icon.classList.add('active');
        icon.onerror = function() { this.src=""; this.classList.remove('active'); }
    }

    function updateEV(id, stat, val) {
        val = parseInt(val) || 0;
        if (val > 252) val = 252; if (val < 0) val = 0;
        let total = 0;
        STATS.forEach(s => { if (s !== stat) total += parseInt(document.getElementById(`num-${id}-${s}`).value) || 0; });
        if (val > MAX_EVS - total) val = MAX_EVS - total;
        
        document.getElementById(`range-${id}-${stat}`).value = val;
        document.getElementById(`num-${id}-${stat}`).value = val;
        
        const rem = MAX_EVS - (total + val);
        const lbl = document.getElementById(`remain-${id}`);
        lbl.innerText = `Restam: ${rem}`;
        lbl.style.color = rem === 0 ? "#d1a720" : "#4dff88";
    }

    // --- MODAL L√ìGICA (IMPORT/EXPORT UNIFICADO) ---
    function openIOModal() {
        // GERA O TEXTO ATUAL (EXPORT)
        let fullText = "";
        const tier = document.getElementById('teamTier').value;
        if (tier) fullText += `=== [Gen 9] ${tier} ===\n\n`;

        let hasContent = false;
        document.querySelectorAll('.poke-editor').forEach(ed => {
            const id = ed.id.split('-')[1];
            const name = ed.querySelector('.p-name').value.trim();
            if (!name) return; // Pula vazios
            hasContent = true;
            
            const item = ed.querySelector('.p-item').value.trim();
            const ability = ed.querySelector('.p-ability').value.trim();
            const nature = ed.querySelector('.p-nature').value;
            const level = ed.querySelector('.p-level').value;

            fullText += `${name}${item ? ' @ ' + item : ''}\n`;
            if (ability) fullText += `Ability: ${ability}\n`;
            if (level && level != 100) fullText += `Level: ${level}\n`;

            let evs = [];
            STATS.forEach(s => {
                const val = document.getElementById(`num-${id}-${s}`).value;
                if (val > 0) evs.push(`${val} ${s}`);
            });
            if (evs.length) fullText += `EVs: ${evs.join(' / ')}\n`;
            if (nature) fullText += `${nature} Nature\n`;

            let ivs = [];
            STATS.forEach(s => {
                const val = ed.querySelector(`.p-iv-${s.toLowerCase()}`).value;
                if (val != 31) ivs.push(`${val} ${s}`);
            });
            if (ivs.length) fullText += `IVs: ${ivs.join(' / ')}\n`;

            ed.querySelectorAll('.p-move').forEach(m => {
                if (m.value.trim()) fullText += `- ${m.value.trim()}\n`;
            });
            fullText += "\n";
        });

        if (!hasContent) fullText = ""; // Se n√£o tiver nada, limpa o modal

        document.getElementById('ioText').value = fullText;
        document.getElementById('ioModal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('ioModal').style.display = 'none'; }

    // --- FUN√á√ÉO ADICIONADA: COPIAR PARA √ÅREA DE TRANSFER√äNCIA ---
    function copyToClipboard() {
        const copyText = document.getElementById("ioText");
        if (!copyText.value) { alert("Nada para copiar."); return; }
        
        copyText.select();
        copyText.setSelectionRange(0, 99999); /* Para mobile */
        
        try {
            document.execCommand("copy");
            alert("Time copiado com sucesso!");
        } catch (err) {
            alert("Erro ao copiar. Tente selecionar e copiar manualmente.");
        }
    }

    function processImport() {
        const text = document.getElementById('ioText').value;
        if (!text.trim()) { alert("Cole um time para importar."); return; }

        // Limpa tudo
        document.getElementById('tabsContainer').innerHTML = '';
        document.getElementById('editorsContainer').innerHTML = '';
        slotCounter = 0;

        const blocks = text.split(/\r?\n\r?\n/);
        blocks.forEach(block => {
            if (!block.trim() || block.startsWith("===")) return; // Ignora cabe√ßalho
            
            const id = addNewSlot();
            if (!id) return;

            const lines = block.split('\n');
            const firstLine = lines[0].trim();
            
            let name = firstLine;
            let item = "";
            if (firstLine.includes('@')) {
                const p = firstLine.split('@');
                name = p[0].trim();
                item = p[1].trim();
            }
            // Limpeza de nome (M/F, Nicknames)
            name = name.replace(/\(M\)/g, '').replace(/\(F\)/g, '').trim();
            if (name.includes('(') && name.includes(')')) {
                const m = name.match(/\(([^)]+)\)/);
                if (m) name = m[1]; // Pega a esp√©cie se for apelido
            }

            const ed = document.getElementById(`editor-${id}`);
            const nInp = ed.querySelector('.p-name');
            nInp.value = name; updateImage(id, nInp);
            
            const iInp = ed.querySelector('.p-item');
            iInp.value = item; updateItemIcon(id, iInp);

            let mIdx = 0;
            const mInps = ed.querySelectorAll('.p-move');

            for (let i = 1; i < lines.length; i++) {
                const l = lines[i].trim();
                if (l.startsWith('Ability:')) ed.querySelector('.p-ability').value = l.replace('Ability:', '').trim();
                else if (l.includes('Nature')) ed.querySelector('.p-nature').value = l.split(' ')[0];
                else if (l.startsWith('Level:')) ed.querySelector('.p-level').value = l.replace('Level:', '').trim();
                else if (l.startsWith('EVs:')) {
                    const p = l.replace('EVs:', '').split('/');
                    p.forEach(x => {
                        x = x.trim();
                        const v = parseInt(x);
                        STATS.forEach(s => { if (x.includes(s)) updateEV(id, s, v); });
                    });
                }
                else if (l.startsWith('IVs:')) {
                    const p = l.replace('IVs:', '').split('/');
                    p.forEach(x => {
                        x = x.trim();
                        const v = parseInt(x);
                        STATS.forEach(s => { if (x.includes(s)) ed.querySelector(`.p-iv-${s.toLowerCase()}`).value = v; });
                    });
                }
                else if (l.startsWith('-')) {
                    if (mIdx < 4) { mInps[mIdx].value = l.replace('-', '').trim(); mIdx++; }
                }
            }
        });
        closeModal();
    }
  </script>
</body>
</html>
