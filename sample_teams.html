<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Times - Humble</title>
  <link rel="icon" type="image/png" href="img/mike_anotando2.png">
  <style>
    :root {
      --cor-dourado: #d1a720;
      --cor-fundo: #1a1a1a;
      --cor-texto: #f5f5f5;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, rgba(20,20,20,0.85), rgba(40,30,20,0.85)),
                  url("https://i.imgur.com/vATNRmF.png") no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: var(--cor-texto);
    }

    /* Cabeçalho */
    header {
      position: fixed;
      top: 0;
      left: 0; right: 0;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(20, 20, 20, 0.9);
      border-bottom: 2px solid var(--cor-dourado);
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      z-index: 1000;
    }
    header h1 {
      font-size: 1.6rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--cor-dourado);
    }
    header h1 img { height: 40px; cursor: pointer; }

    .header-right { display: flex; gap: 10px; }
    .btn {
      background: none;
      border: 1px solid var(--cor-dourado);
      color: var(--cor-dourado);
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn:hover { background: var(--cor-dourado); color: var(--cor-fundo); }

    /* Botão Criar Time */
    #criarTimeBtn {
      position: fixed;
      top: 80px; right: 20px;
      background: var(--cor-dourado);
      color: var(--cor-fundo);
      font-size: 1rem;
      font-weight: bold;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
      transition: 0.3s;
      z-index: 900;
    }
    #criarTimeBtn:hover { background: #f1c53b; }

    main { margin-top: 100px; padding: 20px; }

    .time-card {
      background: rgba(30, 25, 20, 0.9);
      border: 1px solid var(--cor-dourado);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    /* Modal genérico */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: rgba(30, 25, 20, 0.95);
      border: 2px solid var(--cor-dourado);
      border-radius: 12px;
      padding: 20px;
      max-width: 750px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      color: var(--cor-texto);
    }

    /* Criador de Pokémon */
    .pokemon-card {
      border: 1px solid var(--cor-dourado);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 15px;
      background: rgba(20,20,20,0.9);
    }
    .pokemon-card h3 { margin: 0 0 10px; color: var(--cor-dourado); }
    .stat { margin: 6px 0; }
    .stat label { display: inline-block; width: 50px; }
    .stat input[type=range] { width: 200px; }
    .iv-value, .ev-value { margin-left: 8px; font-weight: bold; color: var(--cor-dourado); }
    .progress { background: #333; height: 8px; border-radius: 6px; overflow: hidden; margin: 8px 0; }
    .progress-bar { background: var(--cor-dourado); height: 100%; width: 0%; transition: 0.3s; }
    .ev-warning { color: red; font-size: 0.9rem; }
    #salvarTimeBtn {
      background: var(--cor-dourado);
      border: none;
      padding: 10px 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    /* Inputs */
    input, select {
      background: #111;
      border: 1px solid var(--cor-dourado);
      color: var(--cor-texto);
      border-radius: 6px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <a href="index.html"><img src="https://i.imgur.com/XOEcuO8.png" alt="Mascote"></a>
      Humble
    </h1>
    <div class="header-right">
      <button class="btn" id="loginBtn">Login</button>
      <button class="btn" id="signupBtn">Cadastrar</button>
    </div>
  </header>

  <button id="criarTimeBtn">+ Criar Time</button>

  <main id="timesContainer">
    <!-- Times carregados -->
  </main>

  <!-- Modal Login -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email"><br><br>
      <input type="password" id="loginSenha" placeholder="Senha"><br><br>
      <button class="btn" id="loginEmailBtn">Entrar com Email</button>
      <button class="btn" id="googleLoginBtn">Entrar com Google</button>
    </div>
  </div>

  <!-- Modal Cadastro -->
  <div class="modal" id="signupModal">
    <div class="modal-content">
      <h2>Criar Conta</h2>
      <input type="email" id="signupEmail" placeholder="Email"><br><br>
      <input type="password" id="signupSenha" placeholder="Senha"><br><br>
      <button class="btn" id="signupEmailBtn">Cadastrar</button>
    </div>
  </div>

  <!-- Modal Criar Time -->
  <div class="modal" id="timeModal">
    <div class="modal-content">
      <h2>Criar Novo Time</h2>
      <div id="pokemonSlots"></div>
      <button id="salvarTimeBtn">Salvar Time</button>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut,
             createUserWithEmailAndPassword, signInWithEmailAndPassword } 
             from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getDatabase, ref, push, onValue } 
             from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "SUA_KEY",
      authDomain: "sampleteans.firebaseapp.com",
      databaseURL: "https://sampleteans-default-rtdb.firebaseio.com",
      projectId: "sampleteans",
      storageBucket: "sampleteans.firebasestorage.app",
      messagingSenderId: "1069510029261",
      appId: "1:1069510029261:web:ccafa840ebf0e2a0e85e84"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    const loginModal = document.getElementById("loginModal");
    const signupModal = document.getElementById("signupModal");
    const timeModal = document.getElementById("timeModal");

    // Abrir modais
    document.getElementById("loginBtn").onclick = ()=>loginModal.style.display="flex";
    document.getElementById("signupBtn").onclick = ()=>signupModal.style.display="flex";
    document.getElementById("criarTimeBtn").onclick = ()=>timeModal.style.display="flex";
    window.onclick = e=>{
      if(e.target.classList.contains("modal")) e.target.style.display="none";
    };

    // Cadastro
    document.getElementById("signupEmailBtn").onclick=async()=>{
      const email=document.getElementById("signupEmail").value;
      const senha=document.getElementById("signupSenha").value;
      try{await createUserWithEmailAndPassword(auth,email,senha);signupModal.style.display="none";}
      catch(err){alert(err.message);}
    };

    // Login Email
    document.getElementById("loginEmailBtn").onclick=async()=>{
      const email=document.getElementById("loginEmail").value;
      const senha=document.getElementById("loginSenha").value;
      try{await signInWithEmailAndPassword(auth,email,senha);loginModal.style.display="none";}
      catch(err){alert(err.message);}
    };

    // Login Google
    document.getElementById("googleLoginBtn").onclick=async()=>{
      try{await signInWithPopup(auth,provider);loginModal.style.display="none";}
      catch(err){alert(err.message);}
    };

    // Estado auth
    auth.onAuthStateChanged(user=>{
      if(user) document.getElementById("loginBtn").textContent="Sair ("+(user.displayName||user.email)+")";
      else document.getElementById("loginBtn").textContent="Login";
    });

    // IVs/EVs builder
    const stats=["HP","Atk","Def","SpA","SpD","Spe"];
    const slots=document.getElementById("pokemonSlots");
    for(let i=0;i<6;i++){
      const div=document.createElement("div");
      div.className="pokemon-card";
      div.innerHTML=`
        <h3>Pokémon ${i+1}</h3>
        <label>Tier:</label>
        <select class="tier"><option>OU</option><option>UU</option><option>NU</option><option>Uber</option></select><br><br>
        <label>Nome:</label>
        <input class="pokemonName" placeholder="Ex: Charizard"><br><br>
        <label>Nature:</label>
        <select class="nature"><option>Adamant</option><option>Modest</option><option>Jolly</option><option>Timid</option><option>Bold</option></select><br><br>
        <label>Ability:</label>
        <input class="ability" placeholder="Ex: Blaze"><br><br>
        <label>Moves:</label><br>
        <input class="move" placeholder="Move 1"><br>
        <input class="move" placeholder="Move 2"><br>
        <input class="move" placeholder="Move 3"><br>
        <input class="move" placeholder="Move 4"><br><br>
        <strong>IVs</strong><br>
        ${stats.map(s=>`<div class="stat"><label>${s}</label><input type="range" min="0" max="31" value="31" class="iv"><span class="iv-value">31</span></div>`).join("")}
        <br><strong>EVs</strong><br>
        ${stats.map(s=>`<div class="stat"><label>${s}</label><input type="range" min="0" max="252" step="4" value="0" class="ev"><span class="ev-value">0</span></div>`).join("")}
        <div class="progress"><div class="progress-bar"></div></div>
        <div class="ev-warning"></div>
      `;
      slots.appendChild(div);
    }

    // Atualizar sliders
    slots.addEventListener("input",e=>{
      if(e.target.classList.contains("iv")) e.target.nextElementSibling.textContent=e.target.value;
      if(e.target.classList.contains("ev")){
        e.target.nextElementSibling.textContent=e.target.value;
        validateEVs(e.target.closest(".pokemon-card"));
      }
    });
    function validateEVs(card){
      let evs=[...card.querySelectorAll(".ev")].map(ev=>parseInt(ev.value));
      let total=evs.reduce((a,b)=>a+b,0);
      let over252=evs.filter(v=>v===252).length;
      let warning=card.querySelector(".ev-warning");
      let bar=card.querySelector(".progress-bar");
      bar.style.width=(total/508*100)+"%";
      if(total>508) warning.textContent="⚠ Máx total 508 EVs";
      else if(over252>2) warning.textContent="⚠ Máx 2 stats com 252";
      else warning.textContent="";
    }

    // Salvar time
    document.getElementById("salvarTimeBtn").onclick=()=>{
      if(!auth.currentUser) return alert("Precisa estar logado!");
      let team=[];
      slots.querySelectorAll(".pokemon-card").forEach(card=>{
        let pokemon={
          tier:card.querySelector(".tier").value,
          name:card.querySelector(".pokemonName").value,
          nature:card.querySelector(".nature").value,
          ability:card.querySelector(".ability").value,
          moves:[...card.querySelectorAll(".move")].map(m=>m.value).filter(Boolean),
          ivs:Object.fromEntries(stats.map((s,i)=>[s,card.querySelectorAll(".iv")[i].value])),
          evs:Object.fromEntries(stats.map((s,i)=>[s,card.querySelectorAll(".ev")[i].value]))
        };
        if(pokemon.name) team.push(pokemon);
      });
      push(ref(db,"teams"),{
        ownerName:auth.currentUser.email||auth.currentUser.displayName,
        ownerUid:auth.currentUser.uid,
        pokemons:team
      });
      timeModal.style.display="none";
      alert("Time salvo!");
    };

    // Carregar times
    const timesContainer=document.getElementById("timesContainer");
    onValue(ref(db,"teams"),snap=>{
      timesContainer.innerHTML="";
      snap.forEach(teamSnap=>{
        const time=teamSnap.val();
        const div=document.createElement("div");
        div.className="time-card";
        div.innerHTML=`<h3>Time de ${time.ownerName||"Anônimo"}</h3><pre>${JSON.stringify(time.pokemons,null,2)}</pre>`;
        timesContainer.appendChild(div);
      });
    });
  </script>
</body>
</html>
