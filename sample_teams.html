<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Team Builder - Humble</title>

  <link rel="icon" type="image/png" href="img/mike_anotando2.png">

  <style>
    :root {
      --cor-dourado: #d1a720;
      --cor-fundo: #1a1a1a;
      --cor-texto: #f5f5f5;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, rgba(20,20,20,0.85), rgba(40,30,20,0.85)),
                  url("https://i.imgur.com/vATNRmF.png") no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: var(--cor-texto);
    }

    /* ---------- Header ---------- */
    header {
      position: fixed;
      top: 0; left:0; right:0;
      width: 100%;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(20,20,20,0.9);
      border-bottom: 2px solid var(--cor-dourado);
      box-shadow: 0 2px 8px rgba(0,0,0,0.6);
      z-index: 1000;
    }

    header h1 {
      font-size: 1.6rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--cor-dourado);
    }

    header h1 img { height: 40px; cursor:pointer; }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-toggle {
      display: flex; flex-direction: column; justify-content: space-between;
      width: 30px; height: 22px; cursor:pointer; z-index:1100;
    }
    .menu-toggle span {
      display: block; height:4px; background: var(--cor-texto); border-radius:4px; transition:0.3s;
    }
    .menu-toggle.active span:nth-child(1) { transform: rotate(45deg) translate(5px,5px);}
    .menu-toggle.active span:nth-child(2) { opacity:0; }
    .menu-toggle.active span:nth-child(3) { transform: rotate(-45deg) translate(5px,-5px); }

    nav {
      position: absolute; 
      top: 100%; 
      right: 20px;
      background: rgba(30,25,20,0.95);
      border:1px solid var(--cor-dourado);
      border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.6);
      display:none;
      flex-direction: column; padding:15px; gap:12px;
      z-index:1200;
    }
    nav.active { display:flex; }
    nav a { color: var(--cor-dourado); text-decoration:none; font-size:1rem; transition:0.2s;}
    nav a:hover { color: var(--cor-texto); }

    main {
      padding: calc(70px + 30px) 20px 20px 20px;
      max-width:1200px;
      margin:auto;
      box-sizing:border-box;
    }

    /* ---------- Auth Buttons ---------- */
    .auth-buttons {
      display:flex;
      gap:10px;
    }

    button {
      background:var(--cor-dourado); color:#000; border:none;
      padding:6px 12px; border-radius:6px; cursor:pointer; font-weight:bold;
    }

    .user-info {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .user-info img { width:32px; height:32px; border-radius:50%; }

    /* ---------- Team Builder ---------- */
    #teamBuilder {
      display:none;
      margin-bottom:30px;
      border:1px solid var(--cor-dourado);
      padding:20px;
      border-radius:12px;
      background: rgba(0,0,0,0.6);
    }

    .pokemon-slot {
      border:1px solid var(--cor-dourado);
      padding:10px; margin-bottom:15px;
      border-radius:8px; background: rgba(0,0,0,0.4);
    }

    /* ---------- Feed ---------- */
    #tierFilter {
      margin-bottom:20px;
      padding:5px;
      border-radius:6px;
      border:1px solid var(--cor-dourado);
      background: rgba(0,0,0,0.4);
      color: var(--cor-texto);
    }

    #timesContainer .time-card {
      border:1px solid var(--cor-dourado);
      padding:15px;
      margin-bottom:20px;
      border-radius:10px;
      background: rgba(0,0,0,0.5);
      max-width:100%;
      word-wrap: break-word;
    }

    .poke-slot {
      margin-bottom:12px;
      padding:8px;
      border-radius:6px;
      background: rgba(0,0,0,0.4);
    }
    .poke-slot h4 { color:var(--cor-dourado); margin:0 0 5px; }

    .like-btn {
      background:none; border:none; cursor:pointer; color:var(--cor-dourado);
      font-size:16px; margin-top:10px; display:flex; align-items:center; gap:5px;
    }
    .like-btn.liked { color:red; font-weight:bold; }

    /* ---------- Popup ---------- */
    .popup {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:2000;
    }
    .popup-content {
      background:#fff; color:#000; padding:20px; border-radius:10px; width:300px; text-align:center;
    }
    .popup-content button { margin-top:8px; }

    @media (max-width:500px){
      header h1{ font-size:1.3rem; }
      nav{ right:5px; left:5px; }
      .header-right{ flex-direction:column; align-items:flex-end; }
    }
  </style>
</head>
<body>
  <header>
    <h1><a href="index.html"><img src="https://i.imgur.com/XOEcuO8.png" alt="Mascote"></a>Humble</h1>
    <div class="header-right">
      <div class="menu-toggle" id="menuBtn"><span></span><span></span><span></span></div>
      <div class="auth-buttons" id="authArea">
        <button id="loginBtn">Login</button>
        <button id="registerBtn">Cadastrar</button>
      </div>
    </div>
  </header>

  <nav id="dropdownMenu">
    <a href="index.html">üè† In√≠cio</a>
    <a href="https://www.humblepixelmon.com.br">üåê Site Oficial</a>
    <a href="Tiers_1.12.html">üó°Ô∏è Tiers 1.12</a>
    <a href="Tiers_1.16.html">üõ°Ô∏è Tiers 1.16</a>
    <a href="notas.html">üìù Notas de Atualiza√ß√£o</a>
  </nav>

  <main>
    <section id="teamBuilder">
      <h2>Criar Time</h2>
      <form id="teamForm">
        <div id="pokemonList"></div>
        <button type="button" id="addPokemon">+ Adicionar Pok√©mon</button>
        <button type="submit">Salvar Time</button>
      </form>
    </section>

    <h2>Feed de Times</h2>
    <select id="tierFilter"><option value="all">Todas as Tiers</option></select>
    <div id="timesContainer"></div>
  </main>

  <!-- Popup Login/Register -->
  <div class="popup" id="authPopup">
    <div class="popup-content">
      <h3 id="popupTitle">Login</h3>
      <input type="text" id="nickInput" placeholder="Nickname (fixo ap√≥s cadastro)">
      <input type="email" id="emailInput" placeholder="Email"><br><br>
      <input type="password" id="passInput" placeholder="Senha"><br><br>
      <button id="popupAction">Continuar</button>
      <button id="googleLogin">Entrar com Google</button>
      <br><br>
      <button onclick="document.getElementById('authPopup').style.display='none'">Cancelar</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider,
             createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getDatabase, ref, set, push, onValue, query, orderByChild } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCno7O_ZGLTDYvSG5kzYU-KpduucWcxQe8",
      authDomain: "sampleteans.firebaseapp.com",
      databaseURL: "https://sampleteans-default-rtdb.firebaseio.com",
      projectId: "sampleteans",
      storageBucket: "sampleteans.firebasestorage.app",
      messagingSenderId: "1069510029261",
      appId: "1:1069510029261:web:ccafa840ebf0e2a0e85e84"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // Menu
    const menuBtn = document.getElementById("menuBtn");
    const dropdownMenu = document.getElementById("dropdownMenu");
    menuBtn.addEventListener("click",()=>{menuBtn.classList.toggle("active"); dropdownMenu.classList.toggle("active");});
    document.addEventListener("click",(e)=>{if(!dropdownMenu.contains(e.target)&&!menuBtn.contains(e.target)){menuBtn.classList.remove("active"); dropdownMenu.classList.remove("active");}});

    // ---------- Vari√°veis ----------
    const authArea=document.getElementById("authArea");
    const teamBuilder=document.getElementById("teamBuilder");
    const authPopup=document.getElementById("authPopup");
    const popupTitle=document.getElementById("popupTitle");
    const popupAction=document.getElementById("popupAction");
    const emailInput=document.getElementById("emailInput");
    const passInput=document.getElementById("passInput");
    const nickInput=document.getElementById("nickInput");
    const googleLogin=document.getElementById("googleLogin");
    const tierFilter=document.getElementById("tierFilter");
    const pokemonList=document.getElementById("pokemonList");
    const addPokemonBtn=document.getElementById("addPokemon");
    const timesContainer=document.getElementById("timesContainer");

    let isRegister=false;
    let pokeCount=0;
    const natures=["Hardy","Lonely","Brave","Adamant","Naughty","Bold","Docile","Relaxed","Impish","Lax","Modest","Mild","Quiet","Bashful","Rash","Calm","Gentle","Sassy","Careful","Quirky","Timid","Hasty","Serious","Jolly","Naive"];
    const tiers=["LC","Monotype","NU","National Dex","National Dex Monotype","National Dex UU","OU","PU","RU","Ubers","UU","ZU","National Dex RU","Monomon","Starter League","Only Smeargle","National Dex Ubers","National Dex AG"];
    tiers.forEach(t=>{ const opt=document.createElement("option"); opt.value=t; opt.textContent=t; tierFilter.appendChild(opt); });

    // ---------- Login / Register ----------
    document.getElementById("loginBtn").onclick=()=>{isRegister=false; popupTitle.textContent="Login"; nickInput.style.display="none"; authPopup.style.display="flex";}
    document.getElementById("registerBtn").onclick=()=>{isRegister=true; popupTitle.textContent="Cadastrar"; nickInput.style.display="block"; authPopup.style.display="flex";}

    popupAction.onclick=async()=>{
      try{
        if(isRegister){
          const userCred=await createUserWithEmailAndPassword(auth,emailInput.value,passInput.value);
          await updateProfile(userCred.user,{ displayName:nickInput.value });
          await set(ref(db,"users/"+userCred.user.uid),{ displayName:nickInput.value, email:emailInput.value, createdAt:Date.now() });
        }else{
          await signInWithEmailAndPassword(auth,emailInput.value,passInput.value);
        }
        authPopup.style.display="none";
      }catch(err){ alert("Erro: "+err.message);}
    };

    googleLogin.onclick=async()=>{
      try{
        const provider=new GoogleAuthProvider();
        const result = await signInWithPopup(auth,provider);
        const user=result.user;
        if(!user.displayName){ alert("Defina nickname!"); return; }
        await set(ref(db,"users/"+user.uid),{ displayName:user.displayName,email:user.email,createdAt:Date.now() });
        authPopup.style.display="none";
      }catch(err){ alert("Erro Google: "+err.message);}
    };

    // ---------- Auth state ----------
    onAuthStateChanged(auth,(user)=>{
      if(user){
        authArea.innerHTML = `<div class="user-info">
          <img src="${user.photoURL||'https://i.pravatar.cc/150'}">
          <span>${user.displayName||user.email}</span>
          <button id="logoutBtn">Sair</button>
        </div>`;
        document.getElementById("logoutBtn").onclick=()=>auth.signOut();
        teamBuilder.style.display="block";
      }else{
        authArea.innerHTML=`<button id="loginBtn">Login</button><button id="registerBtn">Cadastrar</button>`;
        document.getElementById("loginBtn").onclick=()=>{isRegister=false; popupTitle.textContent="Login"; nickInput.style.display="none"; authPopup.style.display="flex";}
        document.getElementById("registerBtn").onclick=()=>{isRegister=true; popupTitle.textContent="Cadastrar"; nickInput.style.display="block"; authPopup.style.display="flex";}
        teamBuilder.style.display="none";
      }
    });

    // ---------- Criar Time ----------
    addPokemonBtn.onclick=()=>{
      if(pokeCount>=6) return alert("M√°ximo 6 Pok√©mons!");
      pokeCount++;
      const div=document.createElement("div"); div.className="pokemon-slot";
      div.innerHTML=`<h3>Pok√©mon ${pokeCount}</h3>
        <input placeholder="Nome" name="name">
        <select name="tier">${tiers.map(t=>`<option>${t}</option>`).join("")}</select>
        <select name="nature">${natures.map(n=>`<option>${n}</option>`).join("")}</select>
        <input placeholder="Habilidade" name="ability">
        <input placeholder="Moves (v√≠rgula)" name="moves">`;
      pokemonList.appendChild(div);
    };

    document.getElementById("teamForm").onsubmit=async(e)=>{
      e.preventDefault();
      const user=auth.currentUser; if(!user){ alert("Precisa logar!"); return; }
      const teamRef=push(ref(db,"teams"));
      let teamData={ owner:user.uid, ownerName:user.displayName||user.email, createdAt:Date.now(), pokemon:{}, likes:{} };
      [...pokemonList.children].forEach((slot,idx)=>{
        const name=slot.querySelector("input[name=name]").value;
        const tier=slot.querySelector("select[name=tier]").value;
        const nature=slot.querySelector("select[name=nature]").value;
        const ability=slot.querySelector("input[name=ability]").value;
        const moves=slot.querySelector("input[name=moves]").value.split(",").map(m=>m.trim()).filter(m=>m);
        teamData.pokemon[idx]={name,tier,nature,ability,moves};
      });
      await set(teamRef,teamData);
      alert("Time salvo!"); pokemonList.innerHTML=""; pokeCount=0;
    };

    // ---------- Feed ----------
    let allTeams=[];
    const teamsRef=query(ref(db,"teams"),orderByChild("createdAt"));
    onValue(teamsRef,(snapshot)=>{
      allTeams=[]; snapshot.forEach(c=>allTeams.push({id:c.key,...c.val()})); allTeams.reverse();
      renderFeed();
    });

    tierFilter.onchange=()=>renderFeed();

    function renderFeed(){
      const filter=tierFilter.value;
      timesContainer.innerHTML="";
      allTeams.forEach(team=>{
        if(filter!=="all" && !Object.values(team.pokemon).some(p=>p.tier===filter)) return;
        const card=document.createElement("div"); card.className="time-card";
        const date=new Date(team.createdAt).toLocaleString();
        let pokemonsHTML="";
        Object.values(team.pokemon).forEach((poke,idx)=>{
          pokemonsHTML+=`<div class="poke-slot">
            <h4>${idx+1}. ${poke.name}</h4>
            <p><b>Tier:</b> ${poke.tier||"N/A"}</p>
            <p><b>Nature:</b> ${poke.nature||"N/A"}</p>
            <p><b>Ability:</b> ${poke.ability||"N/A"}</p>
            <p><b>Moves:</b> ${(poke.moves||[]).join(", ")}</p>
          </div>`;
        });
        const likesCount=team.likes?Object.keys(team.likes).length:0;
        const userLiked=auth.currentUser && team.likes && team.likes[auth.currentUser.uid];
        card.innerHTML=`<h3>Time de ${team.ownerName}</h3><small>${date}</small>
          <div>${pokemonsHTML}</div>
          <button class="like-btn ${userLiked?"liked":""}" data-id="${team.id}">‚ù§Ô∏è ${likesCount}</button>`;
        const likeBtn=card.querySelector(".like-btn");
        likeBtn.onclick=async()=>{
          const user=auth.currentUser; if(!user){ alert("Precisa logar!"); return; }
          const likeRef=ref(db,`teams/${team.id}/likes/${user.uid}`);
          if(userLiked) await set(likeRef,null); else await set(likeRef,true);
        };
        timesContainer.appendChild(card);
      });
    }
  </script>
</body>
</html>
