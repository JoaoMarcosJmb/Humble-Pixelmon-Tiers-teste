<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meus Times</title>
  <style>
    :root {
      --panel: rgba(20,20,28,0.85);
      --gold: #d4af37;
      --muted: #aaa;
    }
    body {
      margin: 0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, rgba(5,6,10,0.92), rgba(12,10,18,0.88)),
        url("https://i.imgur.com/vATNRmF.png") center/cover fixed no-repeat;
      color: #f3f3f3;
      padding: 32px;
      min-height: 100vh;
    }
    h1 {
      color: var(--gold);
      margin-top: 0;
    }
    .team-card {
      background: var(--panel);
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .meta {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 8px;
    }
    button {
      background: var(--gold);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      margin-right: 8px;
    }
    button:hover { filter: brightness(1.1); }
    .like-btn {
      background: transparent;
      color: var(--gold);
      border: 1px solid var(--gold);
      padding: 6px 12px;
    }
    .poke {
      font-size: 0.95rem;
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <h1>Meus Times</h1>
  <div id="teamsContainer">Carregando times...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCno7O_ZGLTDYvSG5kzYU-KpduucWcxQe8",
  authDomain: "sampleteans.firebaseapp.com",
  databaseURL: "https://sampleteans-default-rtdb.firebaseio.com",
  projectId: "sampleteans",
  storageBucket: "sampleteans.firebasestorage.app",
  messagingSenderId: "1069510029261",
  appId: "1:1069510029261:web:ccafa840ebf0e2a0e85e84"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const teamsContainer = document.getElementById('teamsContainer');
  let currentUser = null;

  onAuthStateChanged(auth, user => {
    currentUser = user;
  });

  function teamToShowdown(team) {
    let txt = "";
    (team.pokemon || []).forEach(p => {
      txt += (p.name || "???") + (p.item ? " @ " + p.item : "") + "\\n";
      if (p.ability) txt += "Ability: " + p.ability + "\\n";
      if (p.nature) txt += p.nature + " Nature\\n";
      if (p.evs) txt += "EVs: " + p.evs + "\\n";
      (p.moves || []).forEach(m => txt += "- " + m + "\\n");
      txt += "\\n";
    });
    return txt;
  }

  function renderTeams(teams) {
    teamsContainer.innerHTML = "";
    if (teams.length === 0) {
      teamsContainer.innerHTML = "<p>Nenhum time encontrado.</p>";
      return;
    }
    teams.forEach(team => {
      const card = document.createElement("div");
      card.className = "team-card";

      const title = document.createElement("h2");
      title.style.margin = "0 0 8px 0";
      title.textContent = team.name || "Sem nome";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = `${team.ownerName || "Anônimo"} • ${team.tier || "Sem tier"} • ${new Date(team.createdAt).toLocaleString()}`;

      const list = document.createElement("div");
      (team.pokemon || []).forEach(p => {
        const line = document.createElement("div");
        line.className = "poke";
        line.textContent = p.name || "???";
        list.appendChild(line);
      });

      // Botões
      const btns = document.createElement("div");

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "Copiar Showdown";
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(teamToShowdown(team));
        alert("Copiado para a área de transferência!");
      };
      btns.appendChild(copyBtn);

      const likeBtn = document.createElement("button");
      likeBtn.className = "like-btn";
      const likesCount = team.likes ? Object.keys(team.likes).length : 0;
      const alreadyLiked = currentUser && team.likes && team.likes[currentUser.uid];
      likeBtn.textContent = (alreadyLiked ? "💛 " : "🤍 ") + likesCount;
      likeBtn.onclick = async () => {
        if (!currentUser) {
          alert("Você precisa estar logado para curtir.");
          return;
        }
        const likeRef = ref(db, `teams/${team.id}/likes/${currentUser.uid}`);
        if (alreadyLiked) {
          await set(likeRef, null);
        } else {
          await set(likeRef, true);
        }
      };
      btns.appendChild(likeBtn);

      card.appendChild(title);
      card.appendChild(meta);
      card.appendChild(list);
      card.appendChild(btns);
      teamsContainer.appendChild(card);
    });
  }

  const teamsRef = ref(db, "teams");
  onValue(teamsRef, snapshot => {
    const teams = [];
    snapshot.forEach(child => {
      teams.push({ id: child.key, ...child.val() });
    });
    teams.reverse();
    renderTeams(teams);
  });
</script>
</body>
</html>
